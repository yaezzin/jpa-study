## ê³ ì•„ ê°ì²´

```ê³ ì•„ ê°ì²´ ì œê±°``` : ë¶€ëª¨ ì—”í‹°í‹°ì™€ ì—°ê´€ê´€ê³„ê°€ ëŠì–´ì§„ ìì‹ ì—”í‹°í‹°ë¥¼ ìë™ìœ¼ë¡œ ì‚­ì œí•˜ëŠ” ê¸°ëŠ¥

ğŸ‘‰ ì´ ê¸°ëŠ¥ì„ í†µí•´ ë¶€ëª¨ ì—”í‹°í‹°ì˜ ì»¬ë ‰ì…˜ì—ì„œ ìì‹ ì—”í‹°í‹°ì˜ ì°¸ì¡°ë§Œ ì œê±°í•˜ë©´ ìì‹ ì—”í‹°í‹°ê°€ ìë™ìœ¼ë¡œ ì‚­ì œë˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤!

## ì˜ˆì œ

> ê³ ì•„ ê°ì²´ ì œê±° ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ ì»¬ë ‰ì…˜ì— ```orphanRemoval = true```ë¡œ ì„¤ì •í•´ ì£¼ì—ˆìŒ

```java
@Entity
public class Parent {
    @Id @GeneratedValue
    private Long id;
    
    @OneToMany(mappedBy = "parent", orphanRemoval = true)
    private List<Child> children = new ArrayList<>();
}
```

> ë‹¤ìŒ ì‚¬ìš© ì½”ë“œë¥¼ ë³´ì

```java
Parent parent1 = em.find(Parent.class, id);
parent1.getChildren().remove(0); //ìì‹ ì—”í‹°í‹°ë¥¼ ì»¬ë ‰ì…˜ì—ì„œ ì œê±°
```

> ìœ„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰ í›„ SQLì€ ë‹¤ìŒê³¼ ê°™ë‹¤

```sql
DELETE FROM CHILD WHERE ID=?
```

* ì‚¬ìš© ì½”ë“œë¥¼ ë³´ë©´ ì»¬ë ‰ì…˜ì—ì„œ ì²« ë²ˆì§¸ ìì‹ì„ ì œê±°í–ˆë‹¤
* orphanRemoval = true ì˜µì…˜ìœ¼ë¡œ ì¸í•´ ì»¬ë ‰ì…˜ì—ì„œ ì—”í‹°í‹°ë¥¼ ì œê±°í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ë„ ì‚­ì œë¨
* ê³ ì•„ ê°ì²´ ì œê±° ê¸°ëŠ¥ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ í”ŒëŸ¬ì‹œí•  ë•Œ ì ìš©ë˜ë¯€ë¡œ í”ŒëŸ¬ì‹œ ì‹œì ì— DELETE SQLì— ì‹¤í–‰ë¨

> ëª¨ë“  ìì‹ ì—”í‹°í‹°ë¥¼ ì œê±°í•˜ë ¤ë©´ ì»¬ë ‰ì…˜ì„ ë¹„ìš°ì!

```java
parent1.getChildren.clear();
```

## ê²°ë¡ 

ê³ ì•„ ê°ì²´ ì œê±°ëŠ” ì°¸ì¡°ê°€ ì œê±°ëœ ì—”í‹°í‹°ëŠ” ë‹¤ë¥¸ ê³³ì—ì„œ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” ê³ ì•„ ê°ì²´ë¡œ ë³´ê³  ì‚­ì œí•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤!  
ë”°ë¼ì„œ ì´ ê¸°ëŠ¥ì€ ì°¸ì¡°í•˜ëŠ” ê³³ì´ í•œ ê³³ì¼ ë•Œë§Œ ì‚¬ìš©í•´ì•¼ í•œë‹¤! ğŸ‘‰ ```@OneToOne```, ```@OneToMany```ì—ë§Œ ì‚¬ìš© ê°€ëŠ¥

## ì˜ì†ì„± ì „ì´ + ê³ ì• ê°ì²´, ìƒëª…ì£¼ê¸°

> ë§Œì•½ ```CasacadeType.ALL``` + ```orphanRemoval = true```ë¥¼ ë™ì‹œì— ì‚¬ìš©í•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

* ì¼ë°˜ì ìœ¼ë¡œ ì—”í‹°í‹°ëŠ” em.persist()ë¥¼ í†µí•´ ì˜ì†í™”í•˜ê³  em.remove()ë¥¼ í†µí•´ ì œê±°ë˜ëŠ”ë°, ì´ëŠ” ì—”í‹°í‹° ìŠ¤ìŠ¤ë¡œ ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬í•œë‹¤ëŠ” ëœ»!
* í•˜ì§€ë§Œ ë‘ ì˜µì…˜ì„ ëª¨ë‘ í™œì„±í™”í•˜ë©´ ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ í†µí•´ì„œ ìì‹ì˜ ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤

> ìì‹ì„ ì €ì¥í•˜ë ¤ë©´ ë¶€ëª¨ì— ë“±ë¡ë§Œ í•˜ë©´ë¨ (Casacade)

```java
Parent parent = em.find(Parent.class, parentId);
parent.addChild(child1);
```

> ìì‹ì„ ì‚­ì œí•˜ë ¤ë©´ ë¶€ëª¨ì—ì„œ ì œê±°í•˜ë©´ ë¨ (orphanRemoval)

```java
Parent parent = em.find(Parent.class, parentId);
parent.getChildren().remove(removeObject);
```
